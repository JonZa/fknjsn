<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>fknjsn</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico" />
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png" />
    <link rel="apple-touch-icon" href="apple-touch-icon.png" />

    <!-- SEO -->
    <meta name="description" content="Compare JSON side-by-side. Paste, search, and diff multiple JSON blocks.">
    <link rel="canonical" href="https://fknjsn.com/">
    <meta name="theme-color" content="#1e1e1e">

    <!-- Open Graph -->
    <meta property="og:title" content="fknjsn - JSON Comparison Tool">
    <meta property="og:description" content="Compare JSON side-by-side. Paste, search, and diff multiple JSON blocks.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://fknjsn.com/">
    <meta property="og:site_name" content="fknjsn">
    <meta property="og:image" content="https://fknjsn.com/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="fknjsn - JSON Comparison Tool">
    <meta name="twitter:description" content="Compare JSON side-by-side. Paste, search, and diff multiple JSON blocks.">
    <meta name="twitter:image" content="https://fknjsn.com/og-image.png">

    <!-- Performance -->
    <link rel="preconnect" href="https://unpkg.com" crossorigin>

    <link
      rel="stylesheet"
      href="https://unpkg.com/vue-json-pretty@2.4.0/lib/styles.css"
    />
    <script src="https://unpkg.com/vue@3.4.21/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/vue-json-pretty@2.4.0/lib/vue-json-pretty.js"></script>
    <style>
      :root {
        /* Backgrounds - layered depth */
        --bg-base: #1e1e1e;
        --bg-surface: #252526;
        --bg-elevated: #2d2d2d;
        --bg-hover: #37373d;
        --bg-active: #094771;

        /* Borders */
        --border: #3c3c3c;
        --border-focus: #007acc;

        /* Text */
        --text-primary: #e8e8e8;
        --text-secondary: #a0a0a0;
        --text-secondary-on-active: #d4d4d4;
        --text-muted: #6a6a6a;

        /* JSON syntax highlighting (VS Code colors) */
        --json-key: #9cdcfe;
        --json-string: #ce9178;
        --json-number: #b5cea8;
        --json-boolean: #569cd6;
        --json-null: #569cd6;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        scrollbar-gutter: stable;
        scrollbar-color: #5a5a5a var(--bg-base);
        scrollbar-width: thin;
      }

      /* Custom scrollbars */
      ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
      }
      ::-webkit-scrollbar-track {
        background: var(--bg-base);
      }
      ::-webkit-scrollbar-thumb {
        background: #5a5a5a;
        border-radius: 5px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #6e6e6e;
      }

      ::selection {
        background: var(--bg-active);
        color: white;
      }

      body {
        font-family: "Courier New", Courier, monospace;
        background: var(--bg-base);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        padding-left: 3rem;
        color: var(--text-primary);
      }

      .container {
        width: 100%;
      }

      .card {
        background: var(--bg-surface);
        overflow: hidden;
      }

      h1 {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        background: var(--bg-base);
        color: var(--text-primary);
        padding: 0.5rem;
        font-size: 32px;
        font-weight: 400;
        text-transform: uppercase;
        writing-mode: vertical-rl;
        text-orientation: upright;
        letter-spacing: 0.2em;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        z-index: 100;
        width: 3rem;
        border-right: 1px solid var(--border);
      }

      .rows-container {
        display: flex;
        flex-direction: column;
        gap: 0;
      }

      .row {
        position: relative;
        display: flex;
        gap: 20px;
        padding: 20px;
        min-height: 25vh;
        cursor: pointer;
        transition: all 0.15s ease;
        border-bottom: 1px solid var(--border);

        &:nth-child(odd) {
          background: var(--bg-surface);
        }

        &:nth-child(even) {
          background: var(--bg-elevated);
        }

        &:hover {
          background: var(--bg-hover);
        }

        &.selected {
          outline: 2px solid var(--border-focus);
          outline-offset: -2px;
          background: var(--bg-active);
        }

        &:focus {
          outline: 2px solid var(--border-focus);
          outline-offset: -2px;
        }
      }

      .json-block {
        flex: 1;
        min-width: 300px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .search-input {
        flex: 1;
        height: 32px;
        padding: 0 12px;
        border: 1px solid var(--border);
        border-radius: 4px;
        font-size: 14px;
        font-family: inherit;
        background: var(--bg-elevated);
        color: var(--text-primary);
        transition: border-color 0.15s ease;

        &::placeholder {
          color: var(--text-secondary);
        }

        &:focus {
          outline: none;
          border-color: var(--border-focus);
        }
      }

      .json-viewer {
        flex: 1;
        border: 1px solid var(--border);
        border-radius: 4px;
        padding: 15px;
        background: var(--bg-elevated);
        font-family: "Courier New", Courier, monospace;
        font-size: 14px;
        overflow: auto;
      }

      .empty-state {
        color: var(--text-secondary);
        text-align: center;
        padding: 40px 20px;
      }

      .row.selected .empty-state {
        color: var(--text-secondary-on-active);
      }

      .close-btn {
        background: var(--bg-hover);
        border: 1px solid var(--border);
        border-radius: 4px;
        width: 32px;
        height: 32px;
        min-width: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.15s ease;

        &:hover {
          background: #f14c4c;
          color: white;
          border-color: #f14c4c;
        }
      }

      .row-close-btn,
      .empty-column-close-btn {
        position: absolute;
        top: 8px;
        right: 8px;
      }

      .json-block,
      .empty-column {
        position: relative;
      }

      .add-column-btn {
        background: var(--bg-hover);
        border: 1px solid var(--border);
        border-radius: 4px;
        width: 32px;
        height: 32px;
        min-width: 32px;
        display: flex;
        align-items: center;
        justify-content: center;
        align-self: center;
        color: var(--text-primary);
        cursor: pointer;
        transition: all 0.15s ease;

        &:hover {
          background: var(--bg-elevated);
          color: white;
          border-color: var(--border-focus);
        }

        &:active {
          transform: scale(0.95);
        }
      }

      .search-row {
        display: flex;
        gap: 8px;
        align-items: center;
      }

      .empty-column {
        flex: 1;
        min-width: 300px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px dashed var(--text-muted);
        border-radius: 4px;
        color: var(--text-secondary);
        min-height: 100px;
        cursor: pointer;
        transition: all 0.15s ease;

        &:hover {
          border-color: var(--border-focus);
          color: var(--text-primary);
        }
      }

      /* Column counter badge */
      .column-counter {
        position: absolute;
        top: 8px;
        left: 8px;
        font-size: 11px;
        color: var(--text-muted);
        background: var(--bg-base);
        padding: 2px 6px;
        border-radius: 3px;
        border: 1px solid var(--border);
      }

      /* Search input wrapper for clear button */
      .search-input-wrapper {
        position: relative;
        flex: 1;
      }

      .search-input-wrapper .search-input {
        width: 100%;
        padding-right: 28px;
      }

      .search-clear-btn {
        position: absolute;
        right: 6px;
        top: 50%;
        transform: translateY(-50%);
        background: none;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 16px;
        padding: 4px;
        line-height: 1;
      }
      .search-clear-btn:hover {
        color: var(--text-primary);
      }

      /* New row highlight animation */
      .row.just-added {
        animation: row-highlight 1s ease-out;
      }

      @keyframes row-highlight {
        0% {
          background: var(--border-focus);
          box-shadow: inset 0 0 0 2px var(--border-focus);
        }
        100% {
          background: inherit;
          box-shadow: none;
        }
      }

      /* Toast notifications */
      .toast-container {
        position: fixed;
        bottom: 20px;
        right: 20px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        z-index: 200;
      }

      .toast {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        background: var(--bg-elevated);
        border: 1px solid var(--border);
        border-radius: 6px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        animation: toast-in 0.2s ease-out;
        max-width: 360px;
      }

      .toast.error { border-left: 3px solid #f14c4c; }
      .toast.warning { border-left: 3px solid #cca700; }
      .toast.success { border-left: 3px solid #4ec9b0; }
      .toast.info { border-left: 3px solid #007acc; }

      .toast-message {
        flex: 1;
        color: var(--text-primary);
      }
      .toast-details {
        font-size: 12px;
        color: var(--text-secondary);
        max-width: 200px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }

      .toast-dismiss {
        background: none;
        border: none;
        color: var(--text-secondary);
        cursor: pointer;
        font-size: 18px;
        padding: 0 4px;
      }
      .toast-dismiss:hover {
        color: var(--text-primary);
      }

      @keyframes toast-in {
        from { opacity: 0; transform: translateX(20px); }
        to { opacity: 1; transform: translateX(0); }
      }

      /* vue-json-pretty dark theme overrides */
      .vjs-tree {
        background: transparent !important;
        color: var(--text-primary) !important;
      }
      .vjs-key {
        color: var(--json-key) !important;
      }
      .vjs-value-string {
        color: var(--json-string) !important;
      }
      .vjs-value-number {
        color: var(--json-number) !important;
      }
      .vjs-value-boolean {
        color: var(--json-boolean) !important;
      }
      .vjs-value-null {
        color: var(--json-null) !important;
      }
      .vjs-tree-node:hover {
        background: var(--bg-hover) !important;
      }
    </style>
  </head>
  <body>
    <main id="app" class="container">
      <div class="card">
        <h1>fknjsn</h1>
        <div class="rows-container">
          <div
            v-for="(row, index) in rows"
            :key="row.id"
            class="row"
            :class="{ selected: selectedRowId === row.id, 'just-added': row.justAdded }"
            tabindex="0"
            @click="selectRow(row.id)"
            @keydown.enter="selectRow(row.id)"
          >
            <span v-if="row.blocks.some(b => b.data !== null)" class="column-counter">
              {{ row.blocks.filter(b => b.data !== null).length }}/4
            </span>
            <button
              v-if="rows.length > 4 || row.blocks.some(b => b.data !== null)"
              class="close-btn row-close-btn"
              @click.stop="removeRow(row.id)"
              title="Remove row"
            >
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
            <div v-if="row.blocks.length === 0" class="empty-state">
              CLICK HERE. PASTE JSON.
            </div>
            <template v-for="block in row.blocks" :key="block.id">
              <div v-if="block.data === null" class="empty-column">
                Paste JSON here
                <button
                  class="close-btn empty-column-close-btn"
                  @click.stop="removeColumn(row.id, block.id)"
                  title="Remove column"
                >
                  <svg
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <line x1="18" y1="6" x2="6" y2="18"></line>
                    <line x1="6" y1="6" x2="18" y2="18"></line>
                  </svg>
                </button>
              </div>
              <div v-else class="json-block">
                <div class="search-row">
                  <div class="search-input-wrapper">
                    <input
                      v-model="block.search"
                      placeholder="Search JSON..."
                      class="search-input"
                    />
                    <button
                      v-if="block.search"
                      class="search-clear-btn"
                      @click.stop="block.search = ''"
                      title="Clear search"
                    >&times;</button>
                  </div>
                  <button
                    class="close-btn"
                    @click.stop="removeColumn(row.id, block.id)"
                    title="Remove column"
                  >
                    <svg
                      width="14"
                      height="14"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <line x1="18" y1="6" x2="6" y2="18"></line>
                      <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                  </button>
                </div>
                <div class="json-viewer">
                  <vue-json-pretty
                    :data="block.filteredData"
                    :deep="Infinity"
                    :show-length="true"
                    :show-icon="true"
                  />
                </div>
              </div>
            </template>
            <button
              v-if="row.blocks.length < 4 && row.blocks.some(b => b.data !== null)"
              class="add-column-btn"
              @click.stop="addColumn(row.id)"
              title="Add column"
            >
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </button>
          </div>
        </div>
        <!-- Toast notifications -->
        <div class="toast-container">
          <div v-for="toast in toasts" :key="toast.id" class="toast" :class="toast.type">
            <span class="toast-message">{{ toast.message }}</span>
            <span v-if="toast.details" class="toast-details">{{ toast.details }}</span>
            <button class="toast-dismiss" @click="dismissToast(toast.id)">&times;</button>
          </div>
        </div>
      </div>
    </main>

    <script>
      const { createApp, ref, computed, onMounted, onUnmounted, watch, nextTick } = Vue;

      createApp({
        components: {
          VueJsonPretty: VueJsonPretty.default,
        },
        setup() {
          const rows = ref([
            { id: 1, blocks: [] },
            { id: 2, blocks: [] },
            { id: 3, blocks: [] },
            { id: 4, blocks: [] },
          ]);
          const selectedRowId = ref(1);
          const toasts = ref([]);
          let blockIdCounter = 0;
          let rowIdCounter = 4;
          let toastId = 0;

          function showToast(message, type = 'info', details = null, duration = 4000) {
            const id = ++toastId;
            toasts.value.push({ id, message, type, details });
            setTimeout(() => {
              toasts.value = toasts.value.filter(t => t.id !== id);
            }, duration);
          }

          function dismissToast(id) {
            toasts.value = toasts.value.filter(t => t.id !== id);
          }

          function selectRow(id) {
            selectedRowId.value = id;
          }

          function filterJSON(data, search) {
            if (!search) return data;

            const lowerQuery = search.toLowerCase();

            function searchInValue(value, key = "") {
              // Check if key matches
              if (key.toLowerCase().includes(lowerQuery)) {
                return true;
              }

              // Check if value matches (for primitives)
              if (
                typeof value === "string" &&
                value.toLowerCase().includes(lowerQuery)
              ) {
                return true;
              }
              if (
                typeof value === "number" &&
                value.toString().includes(lowerQuery)
              ) {
                return true;
              }
              if (
                typeof value === "boolean" &&
                value.toString().includes(lowerQuery)
              ) {
                return true;
              }

              return false;
            }

            function filterRecursive(obj) {
              if (Array.isArray(obj)) {
                const filtered = [];
                obj.forEach((item) => {
                  if (typeof item === "object" && item !== null) {
                    const filteredItem = filterRecursive(item);
                    if (Object.keys(filteredItem).length > 0) {
                      filtered.push(filteredItem);
                    }
                  } else if (searchInValue(item)) {
                    filtered.push(item);
                  }
                });
                return filtered;
              }

              if (typeof obj === "object" && obj !== null) {
                const filtered = {};
                for (const [key, value] of Object.entries(obj)) {
                  if (typeof value === "object" && value !== null) {
                    const filteredValue = filterRecursive(value);
                    if (
                      (Array.isArray(filteredValue) &&
                        filteredValue.length > 0) ||
                      (!Array.isArray(filteredValue) &&
                        Object.keys(filteredValue).length > 0)
                    ) {
                      filtered[key] = filteredValue;
                    } else if (searchInValue(value, key)) {
                      filtered[key] = value;
                    }
                  } else if (searchInValue(value, key)) {
                    filtered[key] = value;
                  }
                }
                return filtered;
              }

              return obj;
            }

            const result = filterRecursive(data);

            // Check if result is empty
            if (typeof result === "object" && result !== null) {
              if (Array.isArray(result) && result.length === 0) {
                return { "No matches": "Try a different search term" };
              }
              if (!Array.isArray(result) && Object.keys(result).length === 0) {
                return { "No matches": "Try a different search term" };
              }
            }

            return result;
          }

          function addJSONBlock(rowId, jsonData) {
            const row = rows.value.find((r) => r.id === rowId);
            if (row) {
              row.blocks.push({
                id: ++blockIdCounter,
                data: jsonData,
                search: "",
                filteredData: jsonData,
              });
            }
          }

          function addColumn(rowId) {
            const row = rows.value.find((r) => r.id === rowId);
            if (row && row.blocks.length < 4) {
              row.blocks.push({
                id: ++blockIdCounter,
                data: null,
                search: "",
                filteredData: null,
              });
            }
          }

          function addRow() {
            const newRow = {
              id: ++rowIdCounter,
              blocks: [],
              justAdded: true,
            };
            rows.value.push(newRow);
            selectedRowId.value = newRow.id;
            // Clear the flag after animation completes
            setTimeout(() => { newRow.justAdded = false; }, 1000);
          }

          function removeRow(rowId) {
            const index = rows.value.findIndex((r) => r.id === rowId);
            if (index !== -1) {
              rows.value.splice(index, 1);
              // Ensure at least 4 rows remain
              while (rows.value.length < 4) {
                rows.value.push({ id: ++rowIdCounter, blocks: [] });
              }
              // Select adjacent row: prefer previous, fallback to same index position
              if (selectedRowId.value === rowId) {
                const newIndex = Math.min(index, rows.value.length - 1);
                const adjacentIndex = index > 0 ? index - 1 : newIndex;
                selectedRowId.value = rows.value[adjacentIndex]?.id ?? rows.value[0]?.id;
              }
            }
          }

          function removeColumn(rowId, blockId) {
            const row = rows.value.find((r) => r.id === rowId);
            if (row) {
              const index = row.blocks.findIndex((b) => b.id === blockId);
              if (index !== -1) {
                row.blocks.splice(index, 1);
              }
            }
          }

          // Paste event handler
          const handlePaste = (e) => {
            // Don't intercept paste in input fields
            const tag = document.activeElement?.tagName?.toLowerCase();
            if (tag === "input" || tag === "textarea") return;

            const text = e.clipboardData?.getData("text");
            if (!text || !selectedRowId.value) return;

            try {
              const json = JSON.parse(text);
              const row = rows.value.find(
                (r) => r.id === selectedRowId.value
              );
              if (!row) return;

              // First, try to fill an empty column
              const emptyBlock = row.blocks.find((b) => b.data === null);
              if (emptyBlock) {
                emptyBlock.data = json;
                emptyBlock.filteredData = json;
              } else if (row.blocks.length < 4) {
                // Otherwise add a new column if under limit
                addJSONBlock(selectedRowId.value, json);
              }
            } catch (err) {
              console.error("Invalid JSON pasted:", err);
              showToast("Invalid JSON", "error", err.message);
            }
          };

          onMounted(() => {
            // Load saved state
            const saved = localStorage.getItem("json-rows");
            if (saved) {
              try {
                const savedData = JSON.parse(saved);
                // Initialize filteredData for loaded blocks
                rows.value = (savedData.rows || []).map((row) => ({
                  ...row,
                  blocks: row.blocks.map((block) => ({
                    ...block,
                    filteredData: block.data
                      ? filterJSON(block.data, block.search || "")
                      : null,
                  })),
                }));
                if (rows.value.length === 0) {
                  rows.value = [
                    { id: 1, blocks: [] },
                    { id: 2, blocks: [] },
                    { id: 3, blocks: [] },
                    { id: 4, blocks: [] },
                  ];
                }
                selectedRowId.value = savedData.selectedRowId || 1;
                blockIdCounter = savedData.blockIdCounter || 0;
                rowIdCounter = savedData.rowIdCounter || 4;
                // Ensure at least 4 rows
                while (rows.value.length < 4) {
                  rows.value.push({ id: ++rowIdCounter, blocks: [] });
                }
                // Cap at 4 rows if not all rows have data
                const allHaveData = rows.value.every((row) =>
                  row.blocks.some((b) => b.data !== null)
                );
                if (!allHaveData && rows.value.length > 4) {
                  rows.value = rows.value.slice(0, 4);
                }
              } catch (e) {
                console.error("Failed to load saved data:", e);
              }
            }

            window.addEventListener("paste", handlePaste);
          });

          onUnmounted(() => {
            window.removeEventListener("paste", handlePaste);
          });

          // Computed to track if all rows have data (avoids deep watch overhead)
          const allRowsHaveData = computed(() =>
            rows.value.length >= 4 &&
            rows.value.every((row) => row.blocks.some((b) => b.data !== null))
          );

          // Auto-add row when all rows have data
          watch(allRowsHaveData, (hasData) => {
            if (hasData) {
              addRow();
              nextTick(() => {
                window.scrollBy({
                  top: window.innerHeight * 0.25,
                  behavior: "smooth",
                });
              });
            }
          });

          // Debounce utility
          function debounce(fn, ms) {
            let timeout;
            return (...args) => {
              clearTimeout(timeout);
              timeout = setTimeout(() => fn(...args), ms);
            };
          }

          // Save to localStorage (debounced to avoid excessive writes)
          const saveToStorage = debounce(() => {
            try {
              localStorage.setItem(
                "json-rows",
                JSON.stringify({
                  rows: rows.value.map(({ justAdded, ...row }) => ({
                    ...row,
                    blocks: row.blocks.map(({ filteredData, ...block }) => block),
                  })),
                  selectedRowId: selectedRowId.value,
                  blockIdCounter,
                  rowIdCounter,
                })
              );
            } catch (e) {
              console.error("Failed to save data:", e);
              showToast("Storage full - data may not persist", "warning");
            }
          }, 500);

          watch([rows, selectedRowId], saveToStorage, { deep: true });

          // Update filteredData when data or search changes (debounced for typing performance)
          const updateFilteredData = debounce(() => {
            rows.value.forEach((row) => {
              row.blocks.forEach((block) => {
                if (block.data !== null) {
                  block.filteredData = filterJSON(block.data, block.search);
                }
              });
            });
          }, 150);

          watch(
            () => rows.value.map((r) =>
              r.blocks.map((b) => `${b.id}:${b.search}`).join(",")
            ).join("|"),
            updateFilteredData
          );

          return {
            rows,
            selectedRowId,
            toasts,
            selectRow,
            addColumn,
            removeRow,
            removeColumn,
            dismissToast,
          };
        },
      }).mount("#app");
    </script>
  </body>
</html>
